<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agenda Familiar</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }
    body.light {
      background: #fafafa;
      color: #1e1e1e;
    }
    body.dark {
      background: #1e1e1e;
      color: #f5f5f5;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
      gap: 5px;
      margin-top: 20px;
    }
    .day {
      border: 1px solid #888;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      border-radius: 8px;
      transition: background 0.3s, color 0.3s;
      position: relative;
      font-size: 1rem;
    }
    .day.today {
      background: #005a9c;
      color: #fff;
      font-weight: bold;
    }
    .day.selected {
      background: #0078d4;
      color: #fff;
    }
    .day.holiday::after {
      content: "ðŸŽ‰";
      position: absolute;
      top: 2px;
      right: 5px;
      font-size: 1rem;
    }
    .items-container {
      margin-top: 20px;
      border: 1px solid #666;
      border-radius: 8px;
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
    }
    .items-container ul {
      padding-left: 20px;
    }
    .items-container li {
      margin-bottom: 8px;
      font-size: 1.1rem;
    }
    .items-container button {
      margin-left: 5px;
      font-weight: bold;
    }
    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    input[type="text"] {
      flex: 1;
      padding: 8px;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #888;
    }
    select, button {
      padding: 8px 12px;
      font-size: 1rem;
      border-radius: 4px;
      border: 1px solid #888;
      background: none;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }
    button:hover, select:hover, input:hover {
      background: #ddd;
    }
    body.dark button:hover, body.dark select:hover, body.dark input:hover {
      background: #333;
    }
  </style>
</head>
<body class="light">
  <div class="header">
    <div>
      <button id="prevMonth">&lt;</button>
      <span id="monthYear"></span>
      <button id="nextMonth">&gt;</button>
    </div>
    <div>
      <select id="userSelect"></select>
      <button id="toggleTheme">Tema</button>
      <button id="todayBtn">Hoje</button>
    </div>
  </div>

  <div class="calendar" id="calendar"></div>

  <div>
    <h3 id="selectedDate"></h3>
    <div class="controls">
      <input type="text" id="itemText" placeholder="Adicionar compromisso...">
      <button id="addBtn">Criar</button>
    </div>
    <div class="items-container" id="itemsContainer">
      <ul id="itemsList"></ul>
    </div>
  </div>

  <script>
    const users = ["Rui", "Sandra", "SÃ³nia"];
    let currentUser = users[0];
    let theme = 'light';
    let today = new Date();
    let currentDate = new Date(today.getFullYear(), today.getMonth(), 1);
    let selectedDate = new Date(today);
    let items = JSON.parse(localStorage.getItem('agendaItems')) || [];
    let editItemId = null;

    const fixedHolidays = [
      "01/01","25/04","01/05","10/06","15/08","05/10","01/11","01/12","08/12","25/12",
      "22/05" // Leiria
    ];

    function getEasterDate(year){
      const f = Math.floor,
            G = year % 19,
            C = f(year/100),
            H = (C - f(C/4) - f((8*C+13)/25) + 19*G + 15) % 30,
            I = H - f(H/28)*(1 - f(29/(H+1))*f((21-G)/11)),
            J = (year + f(year/4) + I + 2 - C + f(C/4)) % 7,
            L = I - J,
            month = 3 + f((L+40)/44),
            day = L + 28 - 31*f(month/4);
      return new Date(year, month-1, day);
    }

    function getMarinhaGrandeHoliday(year){
      const easter = getEasterDate(year);
      const holiday = new Date(easter);
      holiday.setDate(easter.getDate() + 40);
      return holiday;
    }

    function isHoliday(day){
      const d = day.getDate().toString().padStart(2,'0');
      const m = (day.getMonth()+1).toString().padStart(2,'0');
      if(fixedHolidays.includes(`${d}/${m}`)) return true;
      const mg = getMarinhaGrandeHoliday(day.getFullYear());
      if(day.toDateString() === mg.toDateString()) return true;
      return false;
    }

    const userSelect = document.getElementById('userSelect');
    const calendarEl = document.getElementById('calendar');
    const monthYearEl = document.getElementById('monthYear');
    const selectedDateEl = document.getElementById('selectedDate');
    const itemsList = document.getElementById('itemsList');
    const itemText = document.getElementById('itemText');
    const addBtn = document.getElementById('addBtn');

    users.forEach(u => {
      const opt = document.createElement('option');
      opt.value = u; opt.textContent = u;
      userSelect.appendChild(opt);
    });

    userSelect.addEventListener('change', () => currentUser = userSelect.value);
    document.getElementById('toggleTheme').addEventListener('click', toggleTheme);
    document.getElementById('todayBtn').addEventListener('click', goToday);
    document.getElementById('prevMonth').addEventListener('click', prevMonth);
    document.getElementById('nextMonth').addEventListener('click', nextMonth);
    addBtn.addEventListener('click', addItem);

    function saveItems() { localStorage.setItem('agendaItems', JSON.stringify(items)); }

    function toggleTheme() { theme = theme==='light' ? 'dark' : 'light'; document.body.className = theme; renderCalendar(); renderItems(); }
    function goToday() { today = new Date(); currentDate = new Date(today.getFullYear(), today.getMonth(), 1); selectedDate = new Date(today); renderCalendar(); renderItems(); }
    function prevMonth() { currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth()-1, 1); renderCalendar(); }
    function nextMonth() { currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 1); renderCalendar(); }

    function addItem(){
      if(!itemText.value.trim()) return;
      if(editItemId){
        items = items.map(i => i.id === editItemId ? { ...i, title: itemText.value, date: selectedDate.toDateString() } : i);
        editItemId = null;
      } else {
        items.push({ id: Date.now(), title: itemText.value, date: selectedDate.toDateString(), creator: currentUser });
      }
      itemText.value = '';
      saveItems();
      renderItems();
    }

    function editItem(item){
      if(item.creator !== currentUser) return;
      itemText.value = item.title;
      selectedDate = new Date(item.date);
      editItemId = item.id;
      renderCalendar();
      renderItems();
    }

    function deleteItem(item){
      if(item.creator !== currentUser) return;
      items = items.filter(i => i.id !== item.id);
      saveItems();
      renderItems();
    }

    function renderCalendar(){
      const monthNames = ["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
      monthYearEl.textContent = monthNames[currentDate.getMonth()] + ' ' + currentDate.getFullYear();
      calendarEl.innerHTML = '';
      const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 0).getDate();
      for(let d = 1; d <= daysInMonth; d++){
        const dayEl = document.createElement('div');
        dayEl.className = 'day';
        const thisDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), d);
        if(thisDate.toDateString() === today.toDateString()) dayEl.classList.add('today');
        if(thisDate.toDateString() === selectedDate.toDateString()) dayEl.classList.add('selected');
        if(isHoliday(thisDate)) dayEl.classList.add('holiday');
        dayEl.textContent = d;
        dayEl.addEventListener('click', () => { selectedDate = thisDate; renderCalendar(); renderItems(); });
        calendarEl.appendChild(dayEl);
      }
    }

    function renderItems(){
      selectedDateEl.textContent = selectedDate.toDateString();
      itemsList.innerHTML = '';
      items.filter(i => i.date === selectedDate.toDateString()).forEach(i => {
        const li = document.createElement('li');
        li.textContent = `${i.title} (${i.creator})`;
        if(i.creator === currentUser){
          const editBtn = document.createElement('button');
          editBtn.textContent = 'Editar';
          editBtn.style.color = '#2e7d32';
          editBtn.addEventListener('click', () => editItem(i));
          const delBtn = document.createElement('button');
          delBtn.textContent = 'Apagar';
          delBtn.style.color = '#d32f2f';
          delBtn.addEventListener('click', () => deleteItem(i));
          li.appendChild(editBtn);
          li.appendChild(delBtn);
        }
        itemsList.appendChild(li);
      });
    }

    renderCalendar();
    renderItems();
  </script>
</body>
</html>

