<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agenda Familiar</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
    transition: background 0.3s, color 0.3s;
  }
  body.light {
    background: #fafafa;
    color: #111;
  }
  body.dark {
    background: #1e1e1e;
    color: #f5f5f5;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
  }
  .calendar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
    gap: 5px;
    margin-top: 20px;
  }
  .day {
    border: 1px solid #888;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    border-radius: 8px;
    transition: background 0.3s, color 0.3s;
  }
  .day.today { background: #005a9c; color: #fff; font-weight: bold; }
  .day.selected { background: #0078d4; color: #fff; }
  .items-container {
    margin-top: 20px;
    border: 1px solid #666;
    border-radius: 8px;
    padding: 10px;
    max-height: 300px;
    overflow-y: auto;
  }
  .items-container ul { padding-left: 20px; }
  .items-container li { margin-bottom: 8px; font-size: 1.1rem; }
  .items-container button { margin-left: 5px; font-weight: bold; }
  .controls { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
  input[type="text"] { flex: 1; padding: 5px; font-size: 1rem; }
  select, button { padding: 5px 10px; font-size: 1rem; }
</style>
</head>
<body class="light">
<div class="header">
  <div>
    <button id="prevMonth">&lt;</button>
    <span id="monthYear"></span>
    <button id="nextMonth">&gt;</button>
  </div>
  <div>
    <select id="userSelect"></select>
    <button id="toggleTheme">Tema</button>
    <button id="todayBtn">Hoje</button>
  </div>
</div>

<div class="calendar" id="calendar"></div>

<div>
  <h3 id="selectedDate"></h3>
  <div class="controls">
    <input type="text" id="itemText" placeholder="Adicionar compromisso...">
    <button id="addBtn">Criar</button>
  </div>
  <div class="items-container" id="itemsContainer">
    <ul id="itemsList"></ul>
  </div>
</div>

<script>
const users = ["Rui", "Sandra", "Sónia"];
let currentUser = users[0];
let theme = 'light';
let today = new Date();
let currentDate = new Date(today.getFullYear(), today.getMonth(), 1);
let selectedDate = new Date(today);
let items = [];
let editItemId = null;

const userSelect = document.getElementById('userSelect');
const calendarEl = document.getElementById('calendar');
const monthYearEl = document.getElementById('monthYear');
const selectedDateEl = document.getElementById('selectedDate');
const itemsList = document.getElementById('itemsList');
const itemText = document.getElementById('itemText');
const addBtn = document.getElementById('addBtn');

users.forEach(u => {
  const opt = document.createElement('option');
  opt.value = u; opt.textContent = u;
  userSelect.appendChild(opt);
});

userSelect.addEventListener('change', () => currentUser = userSelect.value);
document.getElementById('toggleTheme').addEventListener('click', toggleTheme);
document.getElementById('todayBtn').addEventListener('click', goToday);
document.getElementById('prevMonth').addEventListener('click', prevMonth);
document.getElementById('nextMonth').addEventListener('click', nextMonth);
addBtn.addEventListener('click', addItem);

function toggleTheme() {
  theme = theme === 'light' ? 'dark' : 'light';
  document.body.className = theme;
  renderCalendar();
  renderItems();
}

function goToday() {
  today = new Date();
  currentDate = new Date(today.getFullYear(), today.getMonth(), 1);
  selectedDate = new Date(today);
  renderCalendar();
  renderItems();
}

function prevMonth() {
  currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
  renderCalendar();
}

function nextMonth() {
  currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
  renderCalendar();
}

function addItem() {
  if (!itemText.value.trim()) return;
  if(editItemId){
    items = items.map(i => i.id === editItemId ? {...i, title: itemText.value, date: selectedDate.toDateString()} : i);
    editItemId = null;
  } else {
    items.push({id: Date.now(), title: itemText.value, date: selectedDate.toDateString(), creator: currentUser});
  }
  itemText.value = '';
  renderItems();
}

function editItem(item){
  if(item.creator !== currentUser) return;
  itemText.value = item.title;
  selectedDate = new Date(item.date);
  editItemId = item.id;
  renderCalendar();
  renderItems();
}

function deleteItem(item){
  if(item.creator !== currentUser) return;
  items = items.filter(i => i.id !== item.id);
  renderItems();
}

function renderCalendar(){
  const monthNames = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];
  monthYearEl.textContent = monthNames[currentDate.getMonth()] + ' ' + currentDate.getFullYear();
  calendarEl.innerHTML = '';
  const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth()+1, 0).getDate();
  for(let d=1; d<=daysInMonth; d++){
    const dayEl = document.createElement('div');
    dayEl.className = 'day';
    const thisDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), d);
    if(thisDate.toDateString() === today.toDateString()) dayEl.classList.add('today');
    if(thisDate.toDateString() === selectedDate.toDateString()) dayEl.classList.add('selected');
    dayEl.textContent = d;
    dayEl.addEventListener('click', () => { selectedDate = thisDate; renderCalendar(); renderItems(); });
    calendarEl.appendChild(dayEl);
  }
}

function renderItems(){
  selectedDateEl.textContent = selectedDate.toDateString();
  itemsList.innerHTML = '';
  items.filter(i=>i.date === selectedDate.toDateString()).forEach(i=>{
    const li = document.createElement('li');
    li.textContent = `${i.title} (${i.creator})`;
    if(i.creator === currentUser){
      const editBtn = document.createElement('button');
      editBtn.textContent = 'Editar';
      editBtn.style.color = '#2e7d32';
      editBtn.addEventListener('click', ()=>editItem(i));
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Apagar';
      delBtn.style.color = '#d32f2f';
      delBtn.addEventListener('click', ()=>deleteItem(i));
      li.appendChild(editBtn);
      li.appendChild(delBtn);
    }
    itemsList.appendChild(li);
  });
}

renderCalendar();
renderItems();
</script>
</body>
</html>

